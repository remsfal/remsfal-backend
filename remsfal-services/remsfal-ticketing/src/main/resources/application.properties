# Core HTTP
quarkus.http.port=8081
quarkus.http.host=0.0.0.0
%dev.quarkus.devservices.enabled=false
%dev.quarkus.http.proxy.enable-forwarded-host=true
%test.quarkus.http.proxy.enable-forwarded-host=true

# MicroProfile / SmallRye JWT configuration
quarkus.smallrye-jwt.enabled=true
mp.jwt.verify.issuer=REMSFAL
%dev.mp.jwt.verify.publickey.location=http://localhost:8080/api/v1/authentication/jwks
%prod.mp.jwt.verify.publickey.location=${PLATFORM_JWKS_URL:http://rmsfl-dev-weu-ca-platform:8080/api/v1/authentication/jwks}
mp.jwt.token.header=Cookie
mp.jwt.token.cookie=remsfal_access_token

# SmallRye JWT Debug-Logging
%dev.quarkus.log.category."io.smallrye.jwt".level=DEBUG
%dev.quarkus.log.category."io.quarkus.smallrye.jwt".level=DEBUG
# HTTP Access Log for authentication failures
quarkus.http.access-log.enabled=true

# MinIO configuration for Dev Profile
quarkus.minio.devservices.enabled=false
%dev.quarkus.minio.host=http://localhost
%dev.quarkus.minio.port=9000
%dev.quarkus.minio.access-key=remsfalAdmin
%dev.quarkus.minio.secret-key=remsfalSecret
%dev.quarkus.minio.secure=false
%test.quarkus.minio.devservices.enabled=true

# Storage Provider Configuration
# Options: 'minio' or 'azure'
storage.provider=azure
%test.storage.provider=minio
storage.bucket-name=remsfal-ticketing

# Azure Blob Storage configuration - loaded from Key Vault via ConfigSource
azure.storage.connection-string=${storage-connection-string}

# Cassandra configuration
jnosql.column.database=remsfal

# Azure Cosmos DB (Cassandra API)
# Dev: loaded from Key Vault via ConfigSource
# Prod: loaded from Container App environment variable
%dev.quarkus.cassandra.keyspace=REMSFAL
%dev.quarkus.cassandra.contact-points=${cosmos-contact-point}
%dev.quarkus.cassandra.auth.username=${cosmos-username}
%dev.quarkus.cassandra.auth.password=${cosmos-password}
%prod.quarkus.cassandra.keyspace=REMSFAL
%prod.quarkus.cassandra.contact-points=${COSMOS_CONTACT_POINT}
%prod.quarkus.cassandra.auth.username=${COSMOS_USERNAME}
%prod.quarkus.cassandra.auth.password=${COSMOS_PASSWORD}
quarkus.cassandra.init.eager-init=false
quarkus.cassandra.local-datacenter=West Europe
# Increase timeouts for Cosmos DB (it's much slower than local Cassandra)
quarkus.cassandra.request.timeout=30s
quarkus.cassandra.connection.init-query-timeout=30s

# Test Cassandra configuration (devservices)
%test.quarkus.cassandra.keyspace=remsfal
%test.quarkus.cassandra.devservices.enabled=true

# Liquibase configuration for Cassandra
quarkus.liquibase.migrate-at-start=true
quarkus.liquibase.change-log=META-INF/liquibase-changelog.xml

# OpenAPI config
quarkus.smallrye-openapi.store-schema-directory=target/openapi
quarkus.smallrye-openapi.store-schema-file-name=ticketing-spec

# Kafka configuration
quarkus.kafka.devservices.service-name=OcrServiceResourceKafka
quarkus.kafka.devservices.shared=true
%dev.quarkus.kafka.devservices.enabled=false
%test.quarkus.kafka.devservices.enabled=true

# Azure Event Hubs (Kafka-compatible)
# Dev: loaded from Key Vault via ConfigSource
# Prod: loaded from Container App environment variable
%dev.mp.messaging.connector.smallrye-kafka.bootstrap.servers=${eventhub-bootstrap-server}
%dev.mp.messaging.connector.smallrye-kafka.security.protocol=SASL_SSL
%dev.mp.messaging.connector.smallrye-kafka.sasl.mechanism=PLAIN
%dev.mp.messaging.connector.smallrye-kafka.sasl.jaas.config=${eventhub-connection-string}

%prod.mp.messaging.connector.smallrye-kafka.bootstrap.servers=${EVENTHUB_BOOTSTRAP_SERVER}
%prod.mp.messaging.connector.smallrye-kafka.security.protocol=SASL_SSL
%prod.mp.messaging.connector.smallrye-kafka.sasl.mechanism=PLAIN
%prod.mp.messaging.connector.smallrye-kafka.sasl.jaas.config=${EVENTHUB_CONNECTION_STRING}

# Tests use Kafka DevServices - no manual config needed

mp.messaging.outgoing.ocr-request.connector=smallrye-kafka
mp.messaging.outgoing.ocr-request.topic=ocr.documents.to_process
mp.messaging.incoming.ocr-result.connector=smallrye-kafka
mp.messaging.incoming.ocr-result.topic=ocr.documents.processed
mp.messaging.incoming.ocr-result.group.id=task-service
mp.messaging.incoming.ocr-result.failure-strategy=ignore
